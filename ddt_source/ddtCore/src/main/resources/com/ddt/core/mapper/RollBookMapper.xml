<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ddt.core.mapper.RollBookMapper">
    
    <sql id="roll_book_base_column">
          id	id
        , user_id	userId
        , name		name
        , valid_start_time	validStartTime
        , valid_end_time	validEndTime
        , roll_start_time	rollStartTime
        , roll_end_time		rollEndTime
        , roll_code			rollCode
        , user_count		userCount
    </sql>
    
    <select id="getRollBookList" parameterType="java.util.Map" resultType="RollBook">
        SELECT
        <include refid="roll_book_base_column"/>
        FROM	ddt_roll_book
        WHERE	user_id = #{userId}
        <if test="limit > 0">
            LIMIT #{offset}, #{limit}
        </if>
    </select>
    
    <select id="getRollBookCount" parameterType="java.util.Map" resultType="int">
        SELECT	COUNT(*)
       	FROM	ddt_roll_book
       	WHERE	user_id = #{userId}
    </select>
    
    <select id="getRollBookById" parameterType="java.util.Map" resultType="RollBook">
        SELECT
        <include refid="roll_book_base_column"/>
        FROM	ddt_roll_book
        WHERE	id = #{id}
        		AND user_id = #{userId}
    </select>
    
    <insert id="addRollBook" parameterType="RollBook" keyColumn="id" keyProperty="id">
        <selectKey keyProperty="id" resultType="long">
            SELECT LAST_INSERT_ID() AS id FROM DUAL
        </selectKey>
        INSERT INTO ddt_roll_book(id, user_id, name, valid_start_time, valid_end_time, user_count, group_id)
        VALUES(#{id}, #{userId}, #{name}, #{validStartTime}, #{validEndTime}, #{userCount}, #{groupId})
    </insert>
    
    <update id="updateRollBook" parameterType="RollBook">
        UPDATE 	  ddt_roll_book
        SET		  name = #{name}
        		, valid_start_time = #{validStartTime}
        		, valid_end_time = #{validEndTime}
        		, user_count = #{userCount}
        WHERE	id = #{id}
        		AND user_id = #{userId}
    </update>
</mapper>